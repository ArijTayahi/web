{% extends 'base.html.twig' %}

{% block title %}Produits Médicaux - MedTime{% endblock %}

{% block body %}
<div class="container-fluid" style="background-color: #f3f6f9; min-height: 100vh;">
    <div class="row">
        {# Sidebar for filtering #}
        <aside class="col-md-3 col-lg-2 d-md-block bg-white sidebar collapse shadow-sm" style="min-height: 100vh; margin-top: 72px;">
            <div class="position-sticky pt-4">
                <h5 class="px-3 mb-3 fw-bold">Filtrer les produits</h5>
                
                <form action="{{ path('app_products') }}" method="get" class="px-3 mb-4">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control form-control-sm" placeholder="Rechercher..." value="{{ search }}">
                        <button class="btn btn-outline-secondary btn-sm" type="submit"><i class="fas fa-search"></i></button>
                    </div>
                </form>

                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-2 text-muted text-uppercase small fw-bold">
                    <span>Catégories</span>
                </h6>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link py-2 {% if not selectedCategory %}active fw-bold text-primary{% else %}text-dark{% endif %}" href="{{ path('app_products', {q: search}) }}">
                            Toutes les catégories
                        </a>
                    </li>
                    {% for category in categories %}
                        <li class="nav-item">
                            <a class="nav-link py-2 {% if selectedCategory == category.id %}active fw-bold text-primary{% else %}text-dark{% endif %}" href="{{ path('app_products', {category: category.id, q: search}) }}">
                                {{ category.name }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </aside>

        {# Main content #}
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" style="margin-top: 80px;">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
                <h1 class="h2 fw-bold">Produits Médicaux</h1>
                <a href="{{ path('app_cart') }}" class="btn btn-primary rounded-pill">
                    <i class="fas fa-shopping-cart me-2"></i> Mon Panier
                </a>
            </div>

            {% if products is empty %}
                <div class="alert alert-info border-0 shadow-sm rounded-3">
                    <i class="fas fa-info-circle me-2"></i> Aucun produit trouvé correspondant à votre recherche.
                </div>
            {% else %}
                <div class="row g-4">
                    {% for product in products %}
                        <div class="col-sm-6 col-lg-4 col-xl-3">
                            <div class="card h-100 border-0 shadow-sm rounded-4 product-card">
                                <div class="card-body d-flex flex-column p-4">
                                    <div class="text-center mb-3">
                                        <i class="fas fa-pills fa-3x text-primary"></i>
                                    </div>
                                    <h5 class="card-title fw-bold text-center" style="min-height: 44px;">{{ product.name }}</h5>
                                    <p class="card-text text-muted small flex-grow-1">{{ product.description|slice(0, 70) }}{% if product.description|length > 70 %}...{% endif %}</p>
                                    
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span class="fw-bold fs-5 text-primary">{{ product.price|number_format(2, ',', ' ') }} €</span>
                                        {% if product.isPrescriptionRequired %}
                                            <span class="badge bg-warning text-dark" title="Ordonnance requise"><i class="fas fa-file-prescription me-1"></i> Ordonnance</span>
                                        {% endif %}
                                    </div>

                                    <div class="d-grid">
                                        <a href="#" class="btn btn-outline-primary rounded-pill">
                                            <i class="fas fa-cart-plus me-2"></i> Ajouter au panier
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </main>
    </div>
</div>
<style>
.product-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
.product-card:hover { transform: translateY(-5px); box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important; }
</style>
{% endblock %}